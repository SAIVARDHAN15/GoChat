# Use an official Java runtime as a parent image
FROM eclipse-temurin:21-jdk-alpine

# Set the working directory
WORKDIR /app

# Copy the project files into the container
COPY . .

# Build the application (skipping tests to save time)
# If you use Gradle, change this to: RUN ./gradlew build -x test
RUN ./mvnw clean package -DskipTests

# Run the jar file
# CRITICAL FOR RENDER:
# We use 'sh -c' to allow variable expansion.
# -Dserver.port=${PORT:-8080} tells Java to use the $PORT env var provided by Render.
# If $PORT is missing (like on your laptop), it falls back to 8080.
CMD ["sh", "-c", "java -Dserver.port=${PORT:-8080} -jar target/chat-0.0.1-SNAPSHOT.jar"]